# 本仓库记录24年暑假小学期计算机设计与实践实验

实验名称为： **基于miniRV的SoC设计**，使用`verilog`编写单周期CPU和流水线CPU,解决了流水线CPU的分支冒险和RAW类型的数据冒险。

## 设计概述（所有实现的指令） 
所有实现的指令： 
24 条： 
add sub and or xor sll srl sra addi andi ori xori slli srli srai 
lw sw jalr  
beq bne blt bge  
lui jal 
单周期CPU频率：25MHz 
流水线CPU频率：100MHz 

## 单周期CPU设计 
 
**模块说明**： 
1. 取指模块 
`PC`：根据输入npc更新当前pc值  
`NPC`：输入pc+4和跳转地址，根据控制信号输出信号，选择下一条指令的pc，输出npc 
`IROM`：指令存储器，输入字地址，输出32位指令 
 
2. 译指/写回模块  
`SEXT`：立即数扩展单元，根据控制信号对指令中的立即数进行扩展 
`RF`：寄存器堆，异步读同步写。根据rR1和rR2输出rD1和rD2，时钟上升沿若RF_w_en有效，则写入寄存器wR数据wD 
 
3. 执行模块 
`ALU`：运算器，根据控制信号执行加、减、按位与、按位或、按位异或、逻 辑右移、逻辑左移、算术右移运算  
 
4. 存储模块 
`DRAM`：数据存储器，用于存储数据. 输入地址，写使能，写数据，时钟信号，异步读同步写。时钟上升沿若写使能有效，则写入输入地址写数据，根据输入地址输出读数据。 

5. 控制模块 
`CONTROLLER`：信号控制器，根据指令生成各个器件的控制信号

## 流水线CPU设计 
 
**模块说明**： 
1. 取指模块 
`PC`：根据输入npc更新当前pc值  
`NPC`：输入pc+4和跳转地址，根据控制信号输出信号，选择下一条指令的pc，输出npc 
`IROM`：指令存储器，输入字地址，输出32位指令 
 
2. 译指/写回模块  
`SEXT`：立即数扩展单元，根据控制信号对指令中的立即数进行扩展 
`RF`：寄存器堆，异步读同步写。根据rR1和rR2输出rD1和rD2，时钟上升沿若RF_w_en有效，则写入寄存器wR数据wD 
 
3. 执行模块 
`ALU`：运算器，根据控制信号执行加、减、按位与、按位或、按位异或、逻 辑右移、逻辑左移、算术右移运算  
 
4. 存储模块 
`DRAM`：数据存储器，用于存储数据. 输入地址，写使能，写数据，时钟信号，异步读同步写。时钟上升沿若写使能有效，则写入输入地址写数据，根据输入地址输出读数据。 
 
5. 控制模块  
`CONTROLLER`：信号控制器，根据指令生成各个器件的控制信号 
 
6. 流水线寄存器模块 
`REG_IF_ID`：取指-译码流水寄存器，保存指令取指后的状态 
`REG_ID_EXE`：译码-执行流水寄存器，保存指令译码后的状态 
`REG_EXE_MEM`：执行-访存流水寄存器，保存指令执行后的状态 
`REG_MEM_WB`：访存-写回流水寄存器，保存指令访存后的状态 
 
7. 控制模块 
`HAZARD_DETECTION`:检测是否存在读后写数据冒险，输出数据冒险存在的信号,处理读后写数据冒险 
